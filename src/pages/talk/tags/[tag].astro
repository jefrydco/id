---
import Pagination from "@/components/widgets/Pagination.astro";
import TalkList from "@/components/widgets/TalkList.astro";
import { themeConfig } from "@/config";
import { defaultLocale, getTranslations } from "@/i18n";
import IndexLayout from "@/layouts/IndexLayout.astro";
import {
	getAllUniqueTalkTags,
	getTalksByTagGroupedByYear,
} from "@/utils/talk-tags";

export async function getStaticPaths() {
	const tags = await getAllUniqueTalkTags();
	return tags.map((tag) => ({
		params: { tag },
	}));
}

const locale = defaultLocale;
const t = getTranslations(locale);
const { tag } = Astro.params;
const yearGroups = await getTalksByTagGroupedByYear(tag ?? "", locale);
const totalPages = yearGroups.length;
const currentYearGroup = yearGroups[0];

const pageTitle = currentYearGroup
	? `${t.ui.talksTaggedWith} "${tag}" - ${currentYearGroup.year} - ${themeConfig.site.title}`
	: `${t.ui.talksTaggedWith} "${tag}" - ${themeConfig.site.title}`;
---

<IndexLayout title={pageTitle} description={`${t.ui.talksTaggedWith} ${tag}`} locale={locale} feedSection="talk">
  <div class="tag-page" data-pagefind-ignore="all">
    <h1 class="page-title">{t.ui.talksTaggedWith} <span class="tag-name">"{tag}"</span></h1>
    {currentYearGroup ? (
      <>
        <TalkList yearGroups={[currentYearGroup]} locale={locale} />
        <Pagination currentPage={1} totalPages={totalPages} locale={locale} basePath={`/talk/tags/${tag}`} />
      </>
    ) : (
      <p class="no-talks">{t.ui.noTalksWithTag}</p>
    )}
  </div>
</IndexLayout>

<style>
  .tag-page {
    margin-top: 1.25rem;
  }

  .page-title {
    font-size: var(--heading-1);
    font-weight: var(--font-weight-bold);
    margin: 0 0 1.5rem 0;
  }

  .tag-name {
    color: var(--text-secondary);
  }

  .no-talks {
    color: var(--text-secondary);
  }
</style>
