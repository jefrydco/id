<script is:inline>
;(function () {
  if (window.FaviconThemeSwitcher && window.FaviconThemeSwitcher.initialized) {
    return
  }

  window.FaviconThemeSwitcher = {
    initialized: false,
    faviconLinks: [],
    currentTheme: null,

    svgUrls: {
      light: '/jefrydco-id-light.svg',
      dark: '/jefrydco-id-dark.svg',
      reading: '/jefrydco-id-reading.svg'
    },

    findFaviconLinks() {
      return Array.from(document.querySelectorAll('link[rel="icon"]'))
    },

    detectThemeFromDOM() {
      if (document.documentElement.classList.contains('dark')) return 'dark'
      if (document.documentElement.classList.contains('reading')) return 'reading'
      return 'light'
    },

    updateFavicon(theme) {
      if (this.currentTheme === theme) return
      this.currentTheme = theme

      if (this.faviconLinks.length === 0) {
        this.faviconLinks = this.findFaviconLinks()
      }

      var url = this.svgUrls[theme] || this.svgUrls.light
      for (var i = 0; i < this.faviconLinks.length; i++) {
        this.faviconLinks[i].href = url
      }
    },

    refreshFaviconLinks() {
      this.faviconLinks = this.findFaviconLinks()
      if (this.faviconLinks.length > 0 && this.currentTheme) {
        var url = this.svgUrls[this.currentTheme] || this.svgUrls.light
        for (var i = 0; i < this.faviconLinks.length; i++) {
          this.faviconLinks[i].href = url
        }
      }
    },

    init() {
      this.faviconLinks = this.findFaviconLinks()
      if (this.faviconLinks.length === 0) {
        console.warn('Favicon links not found, skipping theme switcher')
        return
      }

      this.initialized = true

      const theme = window.ThemeManager
        ? window.ThemeManager.getEffectiveTheme()
        : this.detectThemeFromDOM()

      this.updateFavicon(theme)
    }
  }

  if (!window._faviconThemeListenerBound) {
    window._faviconThemeListenerBound = true
    document.addEventListener('themechange', (e) => {
      if (window.FaviconThemeSwitcher && e.detail && e.detail.theme) {
        window.FaviconThemeSwitcher.updateFavicon(e.detail.theme)
      }
    })
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      window.FaviconThemeSwitcher.init()
    })
  } else {
    window.FaviconThemeSwitcher.init()
  }

  document.addEventListener('astro:page-load', () => {
    if (window.FaviconThemeSwitcher) {
      window.FaviconThemeSwitcher.refreshFaviconLinks()

      const theme = window.ThemeManager
        ? window.ThemeManager.getEffectiveTheme()
        : window.FaviconThemeSwitcher.detectThemeFromDOM()

      window.FaviconThemeSwitcher.updateFavicon(theme)
    }
  })
})()
</script>
