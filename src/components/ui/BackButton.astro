---
import { Undo2 } from "@lucide/astro";
import { defaultLocale, getTranslations, type Locale } from "@/i18n";

interface Props {
	locale?: Locale;
	href?: string;
	label?: string;
}

const { locale = defaultLocale, href, label } = Astro.props;
const t = getTranslations(locale);
const homeUrl = locale === "en" ? "/" : `/${locale}/`;
const linkUrl = href || homeUrl;
const linkLabel = label || t.ui.index;
---

<a href={linkUrl} class="back-button" data-pagefind-ignore="all">
  <Undo2 size={16} />
  {linkLabel}
</a>

<script is:inline>
  ;(function () {
    const CONTENT_WIDTH = 55
    const TOC_ENABLED = true

    function adjustBackButtonPosition() {
      const button = document.querySelector('.back-button')
      if (!button) return

      const pageWidth = window.innerWidth
      const margin = (pageWidth - CONTENT_WIDTH * 16) / 2
      const baseMinSpace = 11 * 16
      const minSpace = TOC_ENABLED ? baseMinSpace + 52 : baseMinSpace + 12

      if (margin >= minSpace) {
        button.classList.add('fixed-position')
        const basePosition = margin - baseMinSpace
        const leftPosition = TOC_ENABLED ? basePosition - 40 : basePosition
        button.style.left = `${leftPosition}px`
      } else {
        button.classList.remove('fixed-position')
        button.style.left = ''
      }
    }

    adjustBackButtonPosition()
    document.addEventListener('astro:page-load', adjustBackButtonPosition)
    document.addEventListener('DOMContentLoaded', adjustBackButtonPosition)
    window.addEventListener('resize', adjustBackButtonPosition)
  })()
</script>

<style>
  .back-button {
    width: 8rem;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-family: var(--serif);
    font-size: var(--font-size-m);
    font-style: italic;
    letter-spacing: 0;
    line-height: 1.75;
    color: var(--text-secondary);
    cursor: pointer;
    border: none;
    background-color: transparent;
    position: relative;
    margin-bottom: 2em;
    padding: 0;
    left: -0.175em;
    transition: color 0.2s ease-out;
    text-decoration: none;
  }

  .back-button:hover {
    color: var(--text-primary);
  }

  .back-button:focus-visible {
    outline: 2px solid var(--focus);
    outline-offset: 2px;
    border-radius: 0.125rem;
  }

  @media (hover: none) and (pointer: coarse) {
    .back-button:hover {
      color: var(--text-secondary);
    }
  }

  .back-button svg {
    width: 0.8rem;
    height: 0.8rem;
    flex-shrink: 0;
  }

  .back-button.fixed-position {
    position: fixed;
    top: 6rem;
    margin-bottom: 0;
    padding-left: 0.75rem;
    z-index: 10;
  }
</style>
