---
import { ArrowUp } from "@lucide/astro";
import BottomSheet from "@/components/ui/BottomSheet.astro";
import FocusModeToggle from "@/components/ui/FocusModeToggle.astro";
import MenuTrigger from "@/components/ui/MenuTrigger.astro";
import { defaultLocale, getTranslations, type Locale } from "@/i18n";

interface Props {
	locale?: Locale;
	slug?: string;
	isDetailPage?: boolean;
}

const { locale = defaultLocale, slug, isDetailPage = false } = Astro.props;
const t = getTranslations(locale);
---

<div class="floating-actions" data-pagefind-ignore="all">
  <div class="desktop-only">
    {isDetailPage && <FocusModeToggle locale={locale} />}
  </div>
  <div class="mobile-only">
    <MenuTrigger locale={locale} />
  </div>
  {isDetailPage && (
    <button
      class="back-to-top"
      id="back-to-top"
      title={t.ui.backToTop}
      aria-label={t.ui.backToTop}
    >
      <ArrowUp size={16} />
    </button>
  )}
</div>
<BottomSheet locale={locale} slug={slug} isDetailPage={isDetailPage} />

<script is:inline>
;(function () {
  function init() {
    const button = document.getElementById('back-to-top')
    if (!button || button.dataset.bound === 'true') return
    button.dataset.bound = 'true'

    button.addEventListener('click', (e) => {
      e.preventDefault()
      const motionOK = !window.matchMedia('(prefers-reduced-motion: reduce)').matches
      window.scrollTo({ top: 0, behavior: motionOK ? 'smooth' : 'auto' })
    })
  }

  document.addEventListener('astro:page-load', init)
  document.addEventListener('DOMContentLoaded', init)
})()
</script>

<style>
  .floating-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    position: fixed;
    bottom: 1.5rem;
    right: 1rem;
    z-index: 50;
  }

  .back-to-top {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    transition: opacity 0.2s ease;
  }

  .back-to-top:hover {
    opacity: 0.7;
  }

  .back-to-top:focus-visible {
    outline: 2px solid var(--focus);
    outline-offset: 2px;
    border-radius: 0.25rem;
  }

  @media (prefers-reduced-motion: reduce) {
    .back-to-top {
      transition: none;
    }
  }

  @media (min-width: 1336px) {
    .mobile-only {
      display: none;
    }
  }

  @media (max-width: 1335px) {
    .desktop-only {
      display: none;
    }
  }
</style>
